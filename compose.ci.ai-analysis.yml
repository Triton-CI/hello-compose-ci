models:

  lucy:
    model: hf.co/menlo/lucy-gguf:q4_k_m

  coder-model:
    model: hf.co/qwen/qwen2.5-coder-3b-instruct-gguf:q4_k_m


services:
  # you can start this services independently with:
  # docker compose -f compose.ci.ai-analysis.yml up 
  security-agent:
    build:
      context: ./ai.analyzer
      dockerfile: Dockerfile
    volumes:
      - ./reports:/reports
    environment:
      SYSTEM_INSTRUCTIONS: |
        You are an AI security analyst specialized in container image vulnerability assessment.
        Your task is to analyze vulnerability reports generated by Docker Scout CLI.
        Provide a concise summary of the vulnerabilities found, their severity, and actionable recommendations to remediate them.
      USER_MESSAGE: |
        Please read and analyze the vulnerability report.
        Generate a summary of the vulnerabilities found in the image along with recommendations to fix them.
        Add a table from the results with the following columns: Vulnerability ID, Severity, Description, Recommendation.
      REPORT_FILE_PATH: /reports/cves.analyze.md
      FILE_PATH_TO_ANALYZE: /reports/cves.report.text

    models:
      # jan-nano:
      #   endpoint_var: MODEL_RUNNER_BASE_URL
      #   model_var: CHAT_MODEL_ID
      lucy:
        endpoint_var: MODEL_RUNNER_BASE_URL
        model_var: CHAT_MODEL_ID
    # depends_on:
    #   image-vulnerability-scan:
    #     condition: service_completed_successfully


  quality-agent:
    build:
      context: ./ai.analyzer
      dockerfile: Dockerfile
    volumes:
      - ./reports:/reports
      - ./:/project
    environment:
      SYSTEM_INSTRUCTIONS: |
        You are a world class Golang expert.
        Your job is to analyze the source code and summarize it.
        Provide recommendations and improvements to increase code quality.
        Generate the summary in markdown format
      USER_MESSAGE: |
        Please read and analyze the provided Go source code.
        Generate a summary of the code along with recommendations to improve its quality.
      REPORT_FILE_PATH: /reports/quality.analyze.md
      FILE_PATH_TO_ANALYZE: /project/main.go

    models:
      coder-model:
        endpoint_var: MODEL_RUNNER_BASE_URL
        model_var: CHAT_MODEL_ID

